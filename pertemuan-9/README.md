<!--START_SECTION:medium-->

[Baca di Medium](https://medium.com/@dikaelsaputra/operasi-dasar-sql-di-spark-sql-b09121677bac?source=rss-272e0aace4a6------2)

 <figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*jfTnuSDHrXThC9OZ.png" /></figure><p>Spark SQL adalah modul dari Apache Spark yang memungkinkan pengguna untuk menjalankan query SQL pada data terdistribusi. Dengan menggunakan Spark SQL, kita dapat melakukan analisis data yang lebih kompleks dengan cepat dan efisien. Blog ini akan membahas berbagai operasi dasar dan lanjutan dalam Spark SQL, yang mencakup menjalankan query sederhana, menggunakan fungsi window, dan melakukan analisis data mendalam.</p><h3>1. SQL Dasar</h3><p>Untuk memulai, kita perlu menyiapkan lingkungan Spark dan membuat sebuah DataFrame yang berisi data karyawan. DataFrame ini akan digunakan untuk berbagai operasi SQL.</p><p>Sebelum membuat DataFrame, alangkah baiknya instalasi PySpark, Pandas, Findspark, dan Matplotlib terlebih dahulu.</p><pre>pip install pyspark==3.4.1<br />pip install pandas<br />pip install findspark<br />pip install matplotlib</pre><p>Perintah-perintah tersebut digunakan untuk menginstal beberapa pustaka Python yang dibutuhkan untuk bekerja dengan Spark, manipulasi data, dan visualisasi. Berikut penjelasannya:</p><ol><li><strong>pyspark==3.4.1</strong>: Menginstal versi PySpark 3.4.1, antarmuka Python untuk Apache Spark, yang mendukung pemrosesan data besar dan analisis data terdistribusi.</li><li><strong>pandas</strong>: Menginstal pustaka Pandas untuk memanipulasi dan menganalisis data dalam format tabel (DataFrame), umum digunakan untuk data berukuran kecil hingga menengah.</li><li><strong>findspark</strong>: Digunakan untuk mempermudah integrasi Spark dengan lingkungan Python dengan memastikan bahwa Spark diatur dengan benar sebelum digunakan.</li><li><strong>matplotlib</strong>: Menginstal pustaka Matplotlib untuk membuat visualisasi data seperti grafik dan chart.</li></ol><pre>import findspark<br />findspark.init()<br />from pyspark.sql import SparkSession<br /># Memulai Spark session<br />spark = SparkSession.builder.appName("BigDataPractice").getOrCreate()</pre><p>Kode tersebut berfungsi untuk memulai sesi Spark dalam Python. Dimulai dengan mengimpor modul findspark dan memanggil findspark.init() untuk memastikan bahwa Python dapat menemukan instalasi Spark. Selanjutnya, kita mengimpor SparkSession dari pustaka PySpark untuk membuat atau mendapatkan sesi Spark baru. Sesi ini dinamai "BigDataPractice" menggunakan metode builder.appName() dan diinisialisasi dengan getOrCreate(). Sesi Spark ini memungkinkan kita menjalankan berbagai operasi Spark SQL, seperti membaca, memproses, dan menganalisis data dalam skala besar.</p><p>Kita dapat membuat tampilan sementara (temporary view) dari DataFrame tersebut, yang memungkinkan kita menjalankan query SQL. Contoh query dasar yang dapat dijalankan:</p><pre>data = [<br />    ('James', 34, 'M', 3000, 1),<br />    ('Anna', 28, 'F', 4100, 2),<br />    ('Lee', 23, 'M', 2700, 1)<br />]<br />columns = ['Name', 'Age', 'Gender', 'Salary', 'DeptId']<br />df = spark.createDataFrame(data, schema=columns)<br />df.createOrReplaceTempView('employees')<br />spark.sql('SELECT * FROM employees').show()<br />spark.sql('SELECT Name, Age FROM employees WHERE Salary > 3000').show()<br />spark.sql('SELECT AVG(Salary) FROM employees').show()</pre><pre>+-----+---+------+------+------+<br />| Name|Age|Gender|Salary|DeptId|<br />+-----+---+------+------+------+<br />|James| 34|     M|  3000|     1|<br />| Anna| 28|     F|  4100|     2|<br />|  Lee| 23|     M|  2700|     1|<br />+-----+---+------+------+------+<br /><br />+----+---+<br />|Name|Age|<br />+----+---+<br />|Anna| 28|<br />+----+---+<br /><br />+------------------+<br />|       avg(Salary)|<br />+------------------+<br />|3266.6666666666665|<br />+------------------+</pre><p>Kode ini membuat tabel karyawan dan menjalankan perintah SQL sederhana. Pertama, data karyawan dibuat dalam bentuk tabel. Lalu, tabel tersebut diberi nama sementara “employees” agar bisa digunakan untuk menjalankan query SQL. Query pertama menampilkan semua data karyawan, query kedua menampilkan nama dan usia karyawan dengan gaji di atas 3000, dan query ketiga menghitung rata-rata gaji karyawan.</p><h3>2. Query Lanjutan untuk Analisis Data</h3><p>Setelah memahami query dasar, kita dapat melanjutkan ke query yang lebih kompleks. Contoh query yang dapat dilakukan termasuk:</p><ul><li><strong>Tugas 2:</strong> Menghitung total gaji berdasarkan jenis kelamin dan kelompok usia.</li></ul><pre>spark.sql('''<br />SELECT Gender, SUM(Salary) as TotalSalary, Age<br />FROM employees<br />GROUP BY Gender, Age<br />ORDER BY Age<br />''').show()</pre><p>Kode ini menjumlahkan total gaji karyawan berdasarkan jenis kelamin dan usia. Data dikelompokkan menurut jenis kelamin dan usia, lalu diurutkan berdasarkan usia. Hasilnya menunjukkan total gaji untuk setiap kelompok jenis kelamin pada setiap usia tertentu.</p><pre>+------+-----------+---+<br />|Gender|TotalSalary|Age|<br />+------+-----------+---+<br />|     M|       2700| 23|<br />|     F|       4100| 28|<br />|     M|       3000| 34|<br />+------+-----------+---+</pre><ul><li><strong>Tugas Tambahan 2: </strong>1. Mencari rata-rata gaji per departemen.</li></ul><pre>spark.sql('''<br />SELECT AVG(Salary) as AverageSalary, DeptId FROM employees GROUP BY DeptId<br />''').show()</pre><p>Kode ini menghitung rata-rata gaji karyawan untuk setiap departemen. Data dikelompokkan berdasarkan ID departemen (DeptId), lalu rata-rata gaji (AVG(Salary)) untuk setiap departemen dihitung dan ditampilkan. Hasilnya menunjukkan rata-rata gaji karyawan di setiap departemen.</p><pre>+-------------+------+<br />|AverageSalary|DeptId|<br />+-------------+------+<br />|       2850.0|     1|<br />|       4100.0|     2|<br />+-------------+------+</pre><ul><li><strong>Tugas Tambahan 2: </strong>2. Mengidentifikasi karyawan yang memiliki gaji di atas rata-rata untuk masing-masing gender.</li></ul><pre>spark.sql('''<br />WITH EmployeeWithAvg AS (<br />    SELECT Name, Salary, Gender, AVG(Salary) OVER() as AverageSalary<br />    FROM employees<br />    WHERE Gender = 'M'<br />)<br />SELECT Name, Salary, Gender, AverageSalary<br />FROM EmployeeWithAvg<br />WHERE Salary > AverageSalary<br />''').show()<br />spark.sql('''<br />WITH EmployeeWithAvg AS (<br />    SELECT Name, Salary, Gender, AVG(Salary) OVER() as AverageSalary<br />    FROM employees<br />    WHERE Gender = 'F'<br />)<br />SELECT Name, Salary, Gender, AverageSalary<br />FROM EmployeeWithAvg<br />WHERE Salary > AverageSalary<br />''').show()</pre><p>Kode ini melakukan perhitungan rata-rata gaji dan menampilkan karyawan yang gajinya di atas rata-rata berdasarkan jenis kelamin. Berikut langkah-langkahnya:</p><p><strong>Menggunakan CTE (Common Table Expression)</strong>:</p><ul><li>Bagian WITH EmployeeWithAvg membuat tabel sementara EmployeeWithAvg yang menyimpan nama, gaji, gender, dan rata-rata gaji seluruh karyawan. Rata-rata gaji dihitung menggunakan AVG(Salary) OVER().</li></ul><p><strong>Query Pertama untuk Gender ‘M’ (Pria)</strong>:</p><ul><li>Memilih hanya karyawan pria (WHERE Gender = 'M') dan menghitung rata-rata gaji. Kemudian, menampilkan karyawan pria yang gajinya lebih tinggi dari rata-rata.</li></ul><p><strong>Query Kedua untuk Gender ‘F’ (Wanita)</strong>:</p><ul><li>Sama seperti query pertama, tapi untuk karyawan wanita (WHERE Gender = 'F'). Hasilnya adalah karyawan wanita yang memiliki gaji di atas rata-rata.</li></ul><p>Hasil dari kedua query ini adalah daftar karyawan pria dan wanita yang gajinya lebih besar daripada rata-rata seluruh gaji karyawan.</p><pre>+-----+------+------+-------------+<br />| Name|Salary|Gender|AverageSalary|<br />+-----+------+------+-------------+<br />|James|  3000|     M|       2850.0|<br />+-----+------+------+-------------+<br /><br />+----+------+------+-------------+<br />|Name|Salary|Gender|AverageSalary|<br />+----+------+------+-------------+<br />+----+------+------+-------------+</pre><p>Dalam query ini, kita juga akan memanfaatkan subqueries dan fungsi agregasi untuk mendapatkan informasi yang lebih mendalam.</p><ul><li><strong>Tugas Tambahan 2: </strong>3. Buat ranking karyawan berdasarkan gaji dalam departemen mereka.</li></ul><pre>spark.sql('''<br />SELECT Name, Age, Gender, Salary, DeptId, DENSE_RANK() OVER (PARTITION BY DeptId ORDER BY Salary DESC) AS SalaryRank<br />FROM employees<br />''').show()</pre><p>Kode ini memberikan peringkat gaji untuk setiap karyawan dalam setiap departemen. Dengan menggunakan fungsi DENSE_RANK(), gaji karyawan diurutkan dari yang tertinggi ke terendah dalam masing-masing departemen, dan setiap karyawan mendapatkan peringkat berdasarkan gajinya. Hasilnya menunjukkan nama, usia, jenis kelamin, gaji, ID departemen, dan peringkat gaji masing-masing karyawan.</p><pre>+-----+---+------+------+------+----------+<br />| Name|Age|Gender|Salary|DeptId|SalaryRank|<br />+-----+---+------+------+------+----------+<br />|James| 34|     M|  3000|     1|         1|<br />|  Lee| 23|     M|  2700|     1|         2|<br />| Anna| 28|     F|  4100|     2|         1|<br />+-----+---+------+------+------+----------+</pre><h3>3. Penggunaan Window Functions dan Subqueries</h3><p>Window functions memungkinkan kita untuk melakukan analisis yang lebih mendalam pada dataset dengan memberikan konteks pada data. Misalnya, kita dapat menggunakan window functions untuk:</p><ul><li><strong>Tugas 3:</strong> Menemukan karyawan dengan gaji tertinggi dalam kelompok usia tertentu.</li></ul><pre>spark.sql('''<br />SELECT Name, Age, Salary, ROW_NUMBER() OVER (PARTITION BY Age ORDER BY Salary DESC) as rank<br />FROM employees<br />''').show()</pre><p>Kode ini memberikan peringkat unik kepada setiap karyawan berdasarkan gaji dalam kelompok usia yang sama. Dengan menggunakan fungsi ROW_NUMBER(), setiap karyawan diurutkan berdasarkan gaji dari yang tertinggi ke terendah untuk setiap kelompok usia, dan diberikan nomor peringkat. Hasilnya menunjukkan nama, usia, gaji, dan peringkat untuk setiap karyawan.</p><pre>+-----+---+------+----+<br />| Name|Age|Salary|rank|<br />+-----+---+------+----+<br />|  Lee| 23|  2700|   1|<br />| Anna| 28|  4100|   1|<br />|James| 34|  3000|   1|<br />+-----+---+------+----+</pre><p>Fungsi seperti ROW_NUMBER() dan DENSE_RANK() dapat digunakan untuk mengurutkan data berdasarkan kriteria tertentu.</p><h3>4. Query SQL Lanjutan</h3><p>Setelah menguasai window functions, kita dapat menjelajahi query yang lebih kompleks. Ini mencakup:</p><ul><li><strong>Tugas 4</strong>: Melakukan multi-level joins antara tabel untuk mendapatkan data yang saling berhubungan.</li></ul><pre>from pyspark.sql import SparkSession<br />spark = SparkSession.builder.appName('Pertemuan9').getOrCreate()<br /><br /># Data setup for complex SQL queries<br />employees = spark.createDataFrame([<br />    ('James', 34, 'M', 3000, 1),<br />    ('Anna', 28, 'F', 4100, 2),<br />    ('Lee', 23, 'M', 2700, 1)<br />], ['Name', 'Age', 'Gender', 'Salary', 'DeptId'])<br />departments = spark.createDataFrame([<br />    (1, 'HR'),<br />    (2, 'Marketing')<br />], ['DeptId', 'DeptName'])<br />projects = spark.createDataFrame([<br />    (1, 'Project A'),<br />    (2, 'Project B')<br />], ['DeptId', 'ProjectName'])<br />employees.createOrReplaceTempView('employees')<br />departments.createOrReplaceTempView('departments')<br />projects.createOrReplaceTempView('projects')<br /><br /># Complex SQL query involving multiple joins and subqueries<br />spark.sql('''<br />SELECT e.Name, e.Age, d.DeptName, p.ProjectName<br />FROM employees e<br />JOIN departments d ON e.DeptId = d.DeptId<br />JOIN projects p ON e.DeptId = p.DeptId<br />''').show()</pre><p>Pertama, kode ini menginisialisasi sesi Spark dan membuat DataFrame untuk karyawan, departemen, dan proyek. Kemudian, setiap DataFrame didaftarkan sebagai tabel sementara. Setelah itu, query SQL dijalankan untuk menggabungkan tabel employees, departments, dan projects berdasarkan DeptId. Hasilnya menunjukkan nama dan usia karyawan, nama departemen, serta nama proyek yang terkait dengan setiap karyawan.</p><pre>+-----+---+---------+-----------+<br />| Name|Age| DeptName|ProjectName|<br />+-----+---+---------+-----------+<br />|  Lee| 23|       HR|  Project A|<br />|James| 34|       HR|  Project A|<br />| Anna| 28|Marketing|  Project B|<br />+-----+---+---------+-----------+</pre><ul><li><strong>Tugas 5</strong>: Mencari rata-rata gaji per departemen sambil memberikan ranking pada setiap karyawan berdasarkan gaji mereka.</li></ul><pre>spark.sql('''<br />SELECT AVG(e.Salary) as AverageSalary, d.DeptId FROM employees e <br />JOIN departments d ON e.DeptId = d.DeptId <br />GROUP BY d.DeptId<br />''').show()<br />spark.sql('''<br />SELECT e.Name, e.Age, e.Salary, d.DeptId, ROW_NUMBER() OVER (PARTITION BY d.DeptName ORDER BY e.Salary DESC) as rank<br />FROM employees e<br />JOIN departments d ON e.DeptId = d.DeptId<br />''').show()</pre><p>Kode ini menjalankan dua query SQL. Query pertama menghitung rata-rata gaji karyawan untuk setiap departemen dan menampilkan hasilnya. Query kedua menampilkan nama, usia, gaji, dan ID departemen karyawan, sambil memberikan peringkat berdasarkan gaji di setiap departemen.</p><pre>+-------------+------+<br />|AverageSalary|DeptId|<br />+-------------+------+<br />|       2850.0|     1|<br />|       4100.0|     2|<br />+-------------+------+<br /><br />+-----+---+------+------+----+<br />| Name|Age|Salary|DeptId|rank|<br />+-----+---+------+------+----+<br />|James| 34|  3000|     1|   1|<br />|  Lee| 23|  2700|     1|   2|<br />| Anna| 28|  4100|     2|   1|<br />+-----+---+------+------+----+</pre><p><strong>Tugas 6</strong>: Gunakan window functions untuk menentukan tren gaji berdasarkan usia di setiap departemen.</p><pre>spark.sql('''<br />SELECT e.Age, d.DeptId, AVG(e.Salary) AS AverageSalary<br />FROM employees e<br />JOIN departments d ON e.DeptId = d.DeptId<br />GROUP BY e.Age, d.DeptId<br />ORDER BY d.DeptId, e.Age<br />''').show()</pre><p>Kode ini menjalankan query SQL untuk menghitung rata-rata gaji karyawan berdasarkan usia dan ID departemen.</p><p>Hasilnya menunjukkan rata-rata gaji untuk setiap kombinasi usia dan departemen, dengan data yang dikelompokkan berdasarkan usia dan ID departemen, serta diurutkan berdasarkan ID departemen dan usia.</p><pre>+---+------+-------------+<br />|Age|DeptId|AverageSalary|<br />+---+------+-------------+<br />| 23|     1|       2700.0|<br />| 34|     1|       3000.0|<br />| 28|     2|       4100.0|<br />+---+------+-------------+</pre><p>Analisis ini dapat memberikan wawasan yang lebih baik tentang struktur organisasi dan distribusi gaji.</p><h3>5. Analisis Data Lanjutan dan Visualisasi</h3><p>Spark SQL juga mendukung analisis data yang lebih kompleks dan visualisasi hasil. Kita dapat menganalisis tren gaji berdasarkan usia dan memvisualisasikannya menggunakan pustaka seperti Matplotlib. Dengan mengubah hasil query menjadi DataFrame Pandas, kita dapat menggunakan grafik untuk menampilkan informasi yang lebih jelas dan mudah dipahami.</p><p><strong>Tugas 7</strong>: Lakukan analisis tren gaji menggunakan Spark SQL dan visualisasikan hasilnya.</p><pre>import matplotlib.pyplot as plt<br />import pandas as pd<br /><br /># Advanced data analysis with visualization<br />salary_trends = spark.sql('''<br />SELECT Age, AVG(Salary) AS AverageSalary<br />FROM employees<br />GROUP BY Age<br />ORDER BY Age<br />''').toPandas()<br /><br /># Visualization of salary trends<br />plt.figure(figsize=(10, 5))<br />plt.plot(salary_trends['Age'], salary_trends['AverageSalary'], marker='o')<br />plt.xlabel('Age')<br />plt.ylabel('Average Salary')<br />plt.title('Salary Trends by Age')<br />plt.grid(True)<br />plt.show()</pre><p>Kode ini melakukan analisis data lanjutan dan visualisasi tren gaji berdasarkan usia. Berikut penjelasan sederhana:</p><ol><li><strong>Analisis Data</strong>: Kode menjalankan query SQL untuk menghitung rata-rata gaji berdasarkan usia karyawan dan mengubah hasilnya menjadi DataFrame pandas.</li><li><strong>Visualisasi</strong>: Menggunakan matplotlib, kode ini membuat grafik garis yang menunjukkan tren gaji rata-rata sesuai dengan usia. Grafik ini memiliki sumbu x untuk usia, sumbu y untuk rata-rata gaji, dan menampilkan titik data dengan marker bulat. Judul grafik adalah "Salary Trends by Age", dan grid ditambahkan untuk memudahkan pembacaan.</li></ol><figure><img alt="" src="https://cdn-images-1.medium.com/max/859/1*IVblraW7sKgCE3nRK9tuQQ.png" /></figure><h3>6. Tugas Praktis</h3><p>Sebagai latihan, Anda dapat melakukan beberapa tugas berikut:</p><p><strong>Tugas 1: Mencari Total Gaji dan Jumlah Karyawan per Departemen</strong>: Gunakan query SQL untuk menghitung total gaji dan jumlah karyawan, kemudian visualisasikan data ini dalam bentuk grafik batang.</p><pre>salary_count_by_dept = spark.sql('''<br />SELECT d.DeptName, SUM(e.Salary) AS TotalSalary, COUNT(e.Name) AS EmployeeCount<br />FROM employees e<br />JOIN departments d ON e.DeptId = d.DeptId<br />GROUP BY d.DeptName<br />''').toPandas()<br /><br />plt.figure(figsize=(10, 5))<br />plt.bar(salary_count_by_dept['DeptName'], salary_count_by_dept['TotalSalary'], color='#6e44ff', label='Total Salary')<br />plt.xlabel('Department')<br />plt.ylabel('Total Salary')<br />plt.title('Total Salary by Department')<br />plt.legend()<br />plt.grid(True)<br />plt.show()<br /><br />plt.figure(figsize=(10, 5))<br />plt.bar(salary_count_by_dept['DeptName'], salary_count_by_dept['EmployeeCount'], color='#00ff7f', label='Employee Count')<br />plt.xlabel('Department')<br />plt.ylabel('Employee Count')<br />plt.title('Number of Employees by Department')<br />plt.legend()<br />plt.grid(True)<br />plt.show()</pre><p>Kode ini menghitung total gaji dan jumlah karyawan untuk setiap departemen, lalu memvisualisasikannya dalam dua grafik batang. Grafik pertama menunjukkan total gaji per departemen dengan warna ungu, sedangkan grafik kedua menunjukkan jumlah karyawan per departemen dengan warna hijau.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/859/1*ZSzHjNfytsrVKj2uv8IY9w.png" /></figure><figure><img alt="" src="https://cdn-images-1.medium.com/max/855/1*5qzb8PJs838eBTcQB_n9iA.png" /></figure><p>Kedua grafik memberikan gambaran tentang perbandingan gaji dan jumlah karyawan di masing-masing departemen.</p><p><strong>Tugas 2: Menemukan Karyawan dengan Gaji di Atas Rata-rata</strong>: Temukan karyawan yang gajinya di atas rata-rata berdasarkan kelompok usia, dan buat visualisasi menggunakan grafik batang atau pie chart.</p><pre>above_avg_salary_count = spark.sql('''<br />WITH AgeAverage AS (<br />    SELECT Age, AVG(Salary) AS AvgSalary<br />    FROM employees<br />    GROUP BY Age<br />)<br />SELECT a.Age, COUNT(e.Name) AS AboveAvgCount<br />FROM employees e<br />JOIN AgeAverage a ON e.Age = a.Age<br />WHERE e.Salary > a.AvgSalary<br />GROUP BY a.Age<br />''').toPandas()<br /><br />plt.figure(figsize=(8, 8))<br />plt.pie(above_avg_salary_count['AboveAvgCount'], labels=above_avg_salary_count['Age'], autopct='%1.1f%%', startangle=140)<br />plt.title('Percentage of Employees with Above Average Salary per Age Group')<br />plt.axis('equal')<br />plt.show()</pre><p>Kode ini menghitung jumlah karyawan yang memiliki gaji lebih tinggi dari rata-rata gaji untuk kelompok usia mereka. Hasilnya ditampilkan dalam bentuk diagram lingkaran yang menunjukkan persentase karyawan dengan gaji di atas rata-rata untuk setiap kelompok usia.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/640/1*sBLtsCpxmZMkRuPlPW15hw.png" /></figure><p>Diagram ini memberikan gambaran visual tentang seberapa besar proporsi karyawan di setiap kelompok usia yang mendapatkan gaji di atas rata-rata.</p><p><strong>Tugas 3: Membuat Dataset yang Lebih Besar</strong>: Buat dataset yang lebih besar dengan 100+ baris data dan lakukan analisis menggunakan fungsi SQL seperti SUM(), AVG(), COUNT(), serta JOIN antar tabel. Hasil analisis ini juga bisa divisualisasikan untuk memberikan insight yang lebih menarik.</p><pre>large_data = [<br />    ('James', 34, 'M', 3000, 1), ('Anna', 28, 'F', 4100, 2), ('Lee', 23, 'M', 2700, 1), ('Mark', 30, 'M', 5000, 1),<br />    ('Sophia', 26, 'F', 3800, 2), ('Chris', 29, 'M', 3200, 1), ('John', 25, 'M', 2600, 1), ('Emily', 31, 'F', 4500, 2),<br />    ('Robert', 35, 'M', 3400, 1), ('Laura', 27, 'F', 4000, 2), ('Tom', 22, 'M', 2800, 1), ('Jessica', 32, 'F', 4300, 2),<br />    ('Alex', 24, 'M', 2900, 1), ('Kate', 29, 'F', 3900, 2), ('Luke', 33, 'M', 3100, 1), ('Sara', 27, 'F', 3700, 2),<br />    ('Peter', 36, 'M', 3500, 1), ('Olivia', 26, 'F', 3600, 2), ('David', 31, 'M', 3300, 1), ('Emma', 24, 'F', 4200, 2),<br />    ('Michael', 35, 'M', 4100, 1), ('Mia', 30, 'F', 3800, 2), ('Daniel', 28, 'M', 3000, 1), ('Zoe', 33, 'F', 4400, 2),<br />    ('Ethan', 25, 'M', 2700, 1), ('Chloe', 34, 'F', 4000, 2), ('Max', 29, 'M', 5000, 1), ('Sophia', 32, 'F', 3900, 2),<br />    ('William', 24, 'M', 2800, 1), ('Ava', 35, 'F', 3500, 2), ('Henry', 26, 'M', 3600, 1), ('Lily', 31, 'F', 3700, 2),<br />    ('Jackson', 23, 'M', 2900, 1), ('Grace', 29, 'F', 3400, 2), ('Oliver', 27, 'M', 3100, 1), ('Isabella', 30, 'F', 3200, 2),<br />    ('Jacob', 22, 'M', 2600, 1), ('Ella', 28, 'F', 4200, 2), ('Mason', 33, 'M', 3700, 1), ('Emily', 27, 'F', 4100, 2),<br />    ('Benjamin', 31, 'M', 3200, 1), ('Amelia', 34, 'F', 4300, 2), ('Lucas', 36, 'M', 3400, 1), ('Sophie', 32, 'F', 3500, 2),<br />    ('Jack', 29, 'M', 3800, 1), ('Harper', 28, 'F', 3600, 2), ('Charlie', 30, 'M', 3100, 1), ('Avery', 25, 'F', 3900, 2),<br />    ('Liam', 33, 'M', 2800, 1), ('Ella', 29, 'F', 4000, 2), ('Sebastian', 31, 'M', 4500, 1), ('Aria', 26, 'F', 4200, 2),<br />    ('Owen', 24, 'M', 2600, 1), ('Scarlett', 34, 'F', 3800, 2), ('Nathan', 35, 'M', 4400, 1), ('Victoria', 32, 'F', 3700, 2),<br />    ('Dylan', 27, 'M', 3300, 1), ('Riley', 30, 'F', 4100, 2), ('Leo', 29, 'M', 3500, 1), ('Hazel', 28, 'F', 3600, 2),<br />    ('Gabriel', 25, 'M', 3900, 1), ('Nora', 33, 'F', 4200, 2), ('Eli', 31, 'M', 3000, 1), ('Camila', 29, 'F', 3700, 2),<br />    ('Isaac', 23, 'M', 3100, 1), ('Violet', 27, 'F', 3500, 2), ('Ryan', 36, 'M', 4000, 1), ('Aurora', 31, 'F', 3900, 2),<br />    ('Luke', 35, 'M', 4500, 1), ('Isla', 30, 'F', 3700, 2), ('Wyatt', 34, 'M', 3200, 1), ('Madison', 29, 'F', 3800, 2),<br />    ('Julian', 28, 'M', 4100, 1), ('Penelope', 32, 'F', 3900, 2), ('Hudson', 25, 'M', 3400, 1), ('Stella', 27, 'F', 3600, 2),<br />    ('Carter', 29, 'M', 3900, 1), ('Hannah', 34, 'F', 4200, 2), ('Hunter', 30, 'M', 3500, 1), ('Layla', 28, 'F', 4000, 2),<br />    ('Connor', 26, 'M', 3700, 1), ('Ellie', 31, 'F', 3600, 2), ('Asher', 33, 'M', 3000, 1), ('Lila', 27, 'F', 3800, 2),<br />    ('Samuel', 24, 'M', 2700, 1), ('Brooklyn', 29, 'F', 4000, 2), ('Ezra', 32, 'M', 4500, 1), ('Claire', 26, 'F', 4300, 2),<br />    ('Miles', 35, 'M', 3800, 1), ('Luna', 30, 'F', 3700, 2), ('Adam', 31, 'M', 4100, 1), ('Zoey', 28, 'F', 4000, 2),<br />    ('Declan', 25, 'M', 3500, 1), ('Savannah', 34, 'F', 3900, 2), ('Nolan', 29, 'M', 3700, 1), ('Eliana', 27, 'F', 3800, 2),<br />    ('Finn', 34, 'M', 4000, 1), ('Naomi', 27, 'F', 4200, 2), ('Noah', 28, 'M', 3900, 1), ('Evelyn', 33, 'F', 3800, 2),<br />    ('Jason', 29, 'M', 3500, 1), ('Samantha', 32, 'F', 3700, 2), ('Logan', 26, 'M', 3600, 1), ('Maya', 30, 'F', 4000, 2),<br />    ('Theo', 25, 'M', 3300, 1), ('Eva', 31, 'F', 3900, 2), ('Jayden', 34, 'M', 4500, 1), ('Alice', 28, 'F', 4300, 2),<br />    ('Zachary', 36, 'M', 3200, 1), ('Lydia', 29, 'F', 3700, 2), ('Blake', 33, 'M', 4100, 1), ('Clara', 27, 'F', 4000, 2),<br />    ('Tyler', 24, 'M', 3400, 1), ('Ivy', 30, 'F', 4200, 2), ('Caleb', 32, 'M', 3500, 1), ('Mila', 34, 'F', 3800, 2),<br />    ('Andrew', 35, 'M', 3900, 1), ('Lilly', 26, 'F', 4100, 2), ('Elliott', 31, 'M', 3600, 1), ('Daisy', 28, 'F', 3900, 2)<br />]<br /><br />columns = ['Name', 'Age', 'Gender', 'Salary', 'DeptId']<br />large_df = spark.createDataFrame(large_data, schema=columns)<br />large_df.createOrReplaceTempView('employees')<br /><br />salary_analysis = spark.sql('''<br />SELECT DeptId, SUM(Salary) AS TotalSalary, AVG(Salary) AS AverageSalary, COUNT(Name) AS EmployeeCount<br />FROM employees<br />GROUP BY DeptId<br />''').toPandas()<br /><br />import numpy as np<br />x = np.arange(len(salary_analysis['DeptId']))<br />bar_width = 0.6<br /><br />fig, (ax1, ax2, ax3) = plt.subplots(1, 3, figsize=(18, 6)) <br /><br />ax1.bar(x, salary_analysis['TotalSalary'], width=bar_width, color='#44ff6e')<br />ax1.set_xlabel('Department ID')<br />ax1.set_ylabel('Total Salary')<br />ax1.set_title('Total Salary by Department')<br />ax1.set_xticks(x)<br />ax1.set_xticklabels(salary_analysis['DeptId'])<br /><br />ax1.set_ylim(0, salary_analysis['TotalSalary'].max() * 1.1)<br />ax1.set_yticks(np.arange(0, salary_analysis['TotalSalary'].max() * 1.1, 50000))<br />ax1.grid(axis='y')<br /><br />for i in range(len(salary_analysis)):<br />    ax1.text(i, salary_analysis['TotalSalary'][i],<br />             f"{salary_analysis['TotalSalary'][i]:,.0f}", <br />             ha='center', va='bottom', color='black')<br /><br />ax2.bar(x, salary_analysis['AverageSalary'], width=bar_width, color='#ff6e6e')<br />ax2.set_xlabel('Department ID')<br />ax2.set_ylabel('Average Salary')<br />ax2.set_title('Average Salary by Department')<br />ax2.set_xticks(x)<br />ax2.set_xticklabels(salary_analysis['DeptId'])<br /><br />ax2.set_ylim(0, salary_analysis['AverageSalary'].max() * 1.3)<br />ax2.set_yticks(np.arange(0, salary_analysis['AverageSalary'].max() * 1.3, 1000))<br />ax2.grid(axis='y')<br /><br />for i in range(len(salary_analysis)):<br />    ax2.text(i, salary_analysis['AverageSalary'][i],<br />             f"{salary_analysis['AverageSalary'][i]:,.0f}", <br />             ha='center', va='bottom', color='black')<br /><br />ax3.bar(x, salary_analysis['EmployeeCount'], width=bar_width, color='#6e6eff')<br />ax3.set_xlabel('Department ID')<br />ax3.set_ylabel('Employee Count')<br />ax3.set_title('Employee Count by Department')<br />ax3.set_xticks(x)<br />ax3.set_xticklabels(salary_analysis['DeptId'])<br /><br />ax3.set_ylim(0, salary_analysis['EmployeeCount'].max() * 1.1)<br />ax3.set_yticks(np.arange(0, salary_analysis['EmployeeCount'].max() * 1.1, 10))<br />ax3.grid(axis='y')<br /><br />for i in range(len(salary_analysis)):<br />    ax3.text(i, salary_analysis['EmployeeCount'][i],<br />             f"{salary_analysis['EmployeeCount'][i]:,.0f}", <br />             ha='center', va='bottom', color='black')<br /><br />plt.subplots_adjust(wspace=0.3, top=0.85)<br />plt.axhline(0, color='black', linewidth=0.8)<br />plt.show()</pre><p>Dalam analisis ini, kami menghitung total gaji, rata-rata gaji, dan jumlah karyawan per departemen. Dari hasil analisis, terlihat bahwa setiap departemen memiliki total gaji yang berbeda-beda, yang mencerminkan jumlah dan gaji individu di dalamnya. Rata-rata gaji memberikan gambaran tentang kompensasi yang diterima karyawan dalam setiap departemen. Selain itu, jumlah karyawan di masing-masing departemen menunjukkan seberapa banyak sumber daya manusia yang ada.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*gVAMTvZ8RhyHSKl638pItQ.png" /></figure><p>Grafik yang dihasilkan memperlihatkan perbandingan visual dari total gaji, rata-rata gaji, dan jumlah karyawan, sehingga memudahkan dalam memahami kondisi keuangan dan sumber daya di setiap departemen.</p><h3>Kesimpulan</h3><p>Blog ini memberikan gambaran umum tentang bagaimana melakukan operasi dasar SQL di Spark SQL, mulai dari query sederhana hingga analisis data yang lebih kompleks. Dengan memanfaatkan kemampuan Spark SQL, Anda dapat melakukan analisis data yang lebih efisien dan mendapatkan wawasan yang lebih mendalam dari data Anda. Silakan tambahkan kode program sesuai kebutuhan Anda untuk menerapkan konsep-konsep yang telah dijelaskan di atas.</p><h3>Referensi</h3><p><a href="https://drive.google.com/file/d/12P9dXGgZrMiX9vJizOhmMV0xNrhjz7ph/view?usp=sharing">Hands_On_Pertemuan_9.ipynb</a></p><img alt="" height="1" src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=b09121677bac" width="1" />
<!--END_SECTION:medium-->
