<!--START_SECTION:medium-->
[Baca di Medium](https://medium.com/@dikaelsaputra/advanced-mongodb-operations-and-data-query-6403253b25a4?source=rss-272e0aace4a6------2)

<figure><img alt="" src="https://cdn-images-1.medium.com/max/686/1*YwH2L_Q7K8vy4FZ5Z6xMmQ.jpeg" /></figure><p>MongoDB adalah salah satu database NoSQL yang paling populer, memberikan fleksibilitas, skalabilitas, dan performa yang sangat baik. Setelah Anda menguasai operasi CRUD (Create, Read, Update, Delete) dasar, saatnya untuk memperdalam pengetahuan dengan teknik-teknik lanjutan yang bisa meningkatkan keterampilan pengelolaan data Anda. Pada artikel ini, kita akan membahas berbagai operasi lanjutan di MongoDB, termasuk query kompleks, agregasi, dan transformasi data. Dengan ini, Anda akan dapat melakukan operasi seperti insert massal, penyaringan berdasarkan kondisi tertentu, dan menggunakan pipeline agregasi untuk analisis data.</p><p>Jika Anda belum menginstal MongoDB, ikuti tutorial instalasi MongoDB Atlas secara lengkap di <a href="https://medium.com/@dikaelsaputra/tutorial-lengkap-mongodb-atlas-dengan-mongodb-compass-d3b015cf4712">sini</a>.</p><h3>1. Advanced CRUD Operations</h3><h4>Latihan 1: Menggunakan bulk_write untuk Beberapa Operasi</h4><p>Salah satu kelebihan MongoDB adalah kemampuannya untuk melakukan beberapa operasi (insert, update, delete) dalam satu batch. Menggunakan metode bulk_write, Anda bisa meningkatkan efisiensi ketika bekerja dengan data dalam jumlah besar.</p><p>Mari kita bayangkan Anda perlu memasukkan dataset tentang kursus yang mencakup informasi tentang jumlah mahasiswa yang terdaftar. Berikut adalah kode untuk melakukannya.</p><h4>Tugas 1: Menyisipkan Dataset courses</h4><pre>from pymongo import MongoClient, InsertOne, UpdateOne, DeleteOne<br /><br /># Establish client connection<br />client = MongoClient('mongodb+srv://<username>:<password>@cluster.mongodb.net/<database>')<br />db = client['university_db']<br />courses_collection = db['courses']<br /><br /># Bulk insert of courses with student enrollments<br />operations = [<br />    InsertOne({'course': 'Math 101', 'enrollments': 30, 'department': 'Mathematics'}),<br />    InsertOne({'course': 'CS 102', 'enrollments': 25, 'department': 'Computer Science'}),<br />    InsertOne({'course': 'History 201', 'enrollments': 20, 'department': 'History'}),<br />    InsertOne({'course': 'Physics 202', 'enrollments': 15, 'department': 'Physics'})<br />]<br />courses_collection.bulk_write(operations)<br />print('Courses inserted successfully.')</pre><p>Dengan kode di atas, kita melakukan operasi InsertOne secara massal menggunakan bulk_write, yang akan menyisipkan empat dokumen kursus dalam satu kali permintaan. Ini lebih efisien dibandingkan dengan menyisipkan setiap dokumen secara terpisah.</p><p><strong>Output:</strong></p><pre>Courses inserted successfully.</pre><figure><img alt="" src="https://cdn-images-1.medium.com/max/975/1*yT2lH-vvGiEDarifiK9T1g.png" /></figure><h4>Tugas 2: Update Data Kursus</h4><p>Jika kita ingin memperbarui informasi tentang kursus, misalnya mengubah jumlah mahasiswa untuk kursus tertentu, kita dapat menggunakan UpdateOne. Berikut contoh untuk mengupdate data kursus dengan nama Math 101 agar memiliki jumlah mahasiswa 35:</p><pre>operations = [<br />    UpdateOne(<br />        {'course': 'Math 101'},<br />        {'$set': {'enrollments': 35}}<br />    )<br />]<br />courses_collection.bulk_write(operations)<br />print('Kursus Math 101 berhasil diperbarui.')</pre><p>Pada contoh di atas, kita menggunakan UpdateOne untuk memperbarui kursus yang memenuhi kondisi tertentu (di sini adalah kursus dengan nama 'Math 101'), dan mengubah field enrollments menjadi 35.</p><p><strong>Output:</strong></p><pre>Kursus Math 101 berhasil diperbarui.</pre><h4>Tugas 3: Menghapus Data Kursus</h4><p>Jika Anda ingin menghapus kursus tertentu, misalnya kursus Physics 202, Anda bisa menggunakan DeleteOne. Berikut adalah contoh untuk menghapus kursus tersebut:</p><pre>operations = [<br />    DeleteOne({'course': 'Physics 202'})<br />]<br />courses_collection.bulk_write(operations)<br />print('Kursus Physics 202 berhasil dihapus.')</pre><p>Di sini, kita menggunakan DeleteOne untuk menghapus dokumen yang memiliki field course dengan nilai 'Physics 202'.</p><p><strong>Output:</strong></p><pre>Kursus Physics 202 berhasil dihapus.</pre><h3>2. Complex Filtering and Querying</h3><p>Setelah data dimasukkan, kita seringkali perlu menyaring data untuk mendapatkan informasi yang lebih relevan. MongoDB menyediakan query yang kuat dan fleksibel untuk menyaring data berdasarkan berbagai kriteria.</p><h4>Latihan 2: Menyaring Kursus Berdasarkan Jumlah Mahasiswa</h4><p>Mari kita saring kursus-kursus yang memiliki lebih dari 20 mahasiswa terdaftar.</p><pre># Query for courses with enrollments greater than 20<br />for course in courses_collection.find({'enrollments': {'$gt': 20}}):<br />    print(course)</pre><p>Kode di atas akan menampilkan semua kursus dengan lebih dari 20 mahasiswa menggunakan operator $gt (greater than atau lebih besar dari). Ini memungkinkan kita untuk memfilter kursus berdasarkan kriteria jumlah mahasiswa.</p><p><strong>Output:</strong></p><pre>{'_id': ObjectId('672b18432f4aee46bf5875d1'), 'course': 'Math 101', 'enrollments': 35, 'department': 'Mathematics'}<br />{'_id': ObjectId('672b18432f4aee46bf5875d2'), 'course': 'CS 102', 'enrollments': 25, 'department': 'Computer Science'}</pre><h4>Tugas 2: Mengambil Kursus dari Departemen Tertentu</h4><p>Sekarang, kita akan menarik hanya kursus yang berasal dari departemen “Computer Science” atau “Mathematics”.</p><pre># Query courses in Computer Science or Mathematics departments<br />for course in courses_collection.find({'department': {'$in': ['Computer Science', 'Mathematics']}}):<br />    print(course)</pre><p>Pada query ini, kita menggunakan operator $in untuk memfilter kursus yang berasal dari salah satu departemen yang ditentukan, yaitu 'Computer Science' atau 'Mathematics'.</p><p><strong>Output:</strong></p><pre>{'_id': ObjectId('672b18432f4aee46bf5875d1'), 'course': 'Math 101', 'enrollments': 35, 'department': 'Mathematics'}<br />{'_id': ObjectId('672b18432f4aee46bf5875d2'), 'course': 'CS 102', 'enrollments': 25, 'department': 'Computer Science'}</pre><h3>3. Aggregation Framework for Data Analysis</h3><p>MongoDB menyediakan fitur agregasi yang sangat berguna untuk analisis data yang lebih kompleks. Dengan agregasi, Anda dapat menghitung nilai seperti jumlah total, rata-rata, atau mengelompokkan data berdasarkan kriteria tertentu.</p><h4>Latihan 3: Menghitung Rata-rata Jumlah Mahasiswa per Departemen</h4><p>Misalkan kita ingin menghitung rata-rata jumlah mahasiswa di setiap departemen.</p><pre># Average enrollment per department using aggregation<br />pipeline = [<br />    {'$group': {'_id': '$department', 'average_enrollment': {'$avg': '$enrollments'}}}<br />]<br />for result in courses_collection.aggregate(pipeline):<br />    print(result)</pre><p>Di sini, kita menggunakan stage $group untuk mengelompokkan dokumen berdasarkan departemen dan menghitung rata-rata jumlah mahasiswa menggunakan operator $avg.</p><p><strong>Output:</strong></p><pre>{'_id': 'Computer Science', 'average_enrollment': 25.0}<br />{'_id': 'History', 'average_enrollment': 20.0}<br />{'_id': 'Mathematics', 'average_enrollment': 35.0}</pre><h4>Tugas 3: Menemukan Kursus dengan Jumlah Mahasiswa Maksimal per Departemen</h4><p>Sekarang, mari kita buat pipeline untuk menemukan kursus dengan jumlah mahasiswa terbesar di setiap departemen.</p><pre># Maximum enrollment per department<br />pipeline = [<br />    {'$group': {'_id': '$department', 'max_enrollment': {'$max': '$enrollments'}}}<br />]<br />for result in courses_collection.aggregate(pipeline):<br />    print(result)</pre><p>Pada pipeline ini, kita menggunakan operator $max untuk menemukan kursus dengan jumlah mahasiswa terbesar di setiap departemen.</p><p><strong>Output:</strong></p><pre>{'_id': 'Mathematics', 'max_enrollment': 35}<br />{'_id': 'Computer Science', 'max_enrollment': 25}<br />{'_id': 'History', 'max_enrollment': 20}</pre><h3>4. Data Transformation using $project and $addFields</h3><p>MongoDB juga memungkinkan kita untuk melakukan transformasi data, seperti mengganti nama field atau menambahkan field baru ke dalam hasil agregasi.</p><h4>Latihan 4: Menggunakan $project untuk Mengganti Nama Field</h4><p>Jika Anda ingin mengganti nama field atau hanya menampilkan beberapa field tertentu, Anda bisa menggunakan operator $project</p><pre># Projection to rename fields<br />pipeline = [<br />    {'$project': {'course_name': '$course', 'department_name': '$department', 'enrollments': 1}}<br />]<br />for result in courses_collection.aggregate(pipeline):<br />    print(result)</pre><p>Pada contoh di atas, kita menggunakan $project untuk mengganti nama field course menjadi course_name dan department menjadi department_name. Selain itu, kita juga hanya menampilkan field enrollments yang sudah ada.</p><p><strong>Output:</strong></p><pre>{'_id': ObjectId('672b18432f4aee46bf5875d1'), 'enrollments': 35, 'course_name': 'Math 101', 'department_name': 'Mathematics'}<br />{'_id': ObjectId('672b18432f4aee46bf5875d2'), 'enrollments': 25, 'course_name': 'CS 102', 'department_name': 'Computer Science'}<br />{'_id': ObjectId('672b18432f4aee46bf5875d3'), 'enrollments': 20, 'course_name': 'History 201', 'department_name': 'History'}</pre><h4>Tugas 4: Menggunakan $addFields untuk Menambahkan Field Baru</h4><p>Anda juga bisa menambahkan field baru berdasarkan kondisi tertentu. Misalnya, kita ingin menambahkan kategori berdasarkan jumlah mahasiswa, apakah kategori “high” (tinggi) atau “low” (rendah).</p><pre># Menambahkan kategori jumlah mahasiswa berdasarkan enrollments<br />pipeline = [<br />    {'$addFields': {'enrollment_category': {'$cond': {'if': {'$gt': ['$enrollments', 20]}, 'then': 'high', 'else': 'low'}}}}<br />]<br />for result in courses_collection.aggregate(pipeline):<br />    print(result)</pre><p>Di sini, kita menggunakan operator $cond di dalam $addFields untuk memberikan nilai kategori ("high" atau "low") pada field baru enrollment_category, berdasarkan jumlah mahasiswa.</p><p><strong>Output:</strong></p><pre>{'_id': ObjectId('672b18432f4aee46bf5875d1'), 'course': 'Math 101', 'enrollments': 35, 'department': 'Mathematics', 'enrollment_category': 'high'}<br />{'_id': ObjectId('672b18432f4aee46bf5875d2'), 'course': 'CS 102', 'enrollments': 25, 'department': 'Computer Science', 'enrollment_category': 'high'}<br />{'_id': ObjectId('672b18432f4aee46bf5875d3'), 'course': 'History 201', 'enrollments': 20, 'department': 'History', 'enrollment_category': 'low'}</pre><h3>Homework</h3><ul><li><strong>Homework 1</strong>: Lakukan agregasi untuk menghitung jumlah kursus per departemen.</li><li><strong>Homework 2</strong>: Gunakan $match dan $group bersama-sama untuk menyaring dan mendapatkan hanya kursus dengan jumlah mahasiswa lebih dari 25 di departemen "Computer Science".</li><li><strong>Homework 3</strong>: Terapkan $lookup untuk menggabungkan koleksi courses dengan koleksi students berdasarkan enrollments mahasiswa.</li></ul><h4>Homework 1: Menghitung Jumlah Kursus per Departemen</h4><pre>pipeline = [<br />    {'$group': {'_id': '$department', 'course_count': {'$sum': 1}}}<br />]<br />for result in courses_collection.aggregate(pipeline):<br />    print(result)</pre><p>Penjelasan: Menggunakan $group untuk mengelompokkan kursus berdasarkan departemen dan menghitung jumlah kursus dengan operator $sum.</p><p><strong>Output:</strong></p><pre>{'_id': 'Mathematics', 'course_count': 1}<br />{'_id': 'History', 'course_count': 1}<br />{'_id': 'Computer Science', 'course_count': 1}</pre><h4>Homework 2: Menyaring Kursus dengan Mahasiswa Lebih dari 25 di Departemen “Computer Science”</h4><pre>pipeline = [<br />    {'$match': {'department': 'Computer Science', 'enrollments': {'$gt': 25}}},<br />    {'$group': {'_id': '$department', 'course_count': {'$sum': 1}}}<br />]<br />for result in courses_collection.aggregate(pipeline):<br />    print(result)</pre><p>Penjelasan: Di sini kita menggunakan $match untuk memfilter kursus dari departemen 'Computer Science' dengan enrollments lebih dari 25, lalu $group untuk menghitung jumlah kursus.</p><h4>Homework 3: Menggabungkan Koleksi courses dan students Menggunakan $lookup</h4><p>Misalkan kita memiliki koleksi students yang menyimpan data mahasiswa yang terdaftar di kursus. Kita dapat menggunakan $lookup untuk menggabungkan koleksi courses dengan koleksi students berdasarkan enrollments.</p><pre>pipeline = [<br />    {<br />        '$lookup': {<br />            'from': 'students',<br />            'localField': 'enrollments',<br />            'foreignField': 'student_id',<br />            'as': 'student_details'<br />        }<br />    }<br />]<br />for result in courses_collection.aggregate(pipeline):<br />    print(result)</pre><p>Penjelasan: Menggunakan $lookup untuk menggabungkan data dari koleksi courses dengan koleksi students berdasarkan field yang relevan.</p><p><strong>Output:</strong></p><pre>{'_id': ObjectId('672b18432f4aee46bf5875d1'), 'course': 'Math 101', 'enrollments': 35, 'department': 'Mathematics', 'student_details': []}<br />{'_id': ObjectId('672b18432f4aee46bf5875d2'), 'course': 'CS 102', 'enrollments': 25, 'department': 'Computer Science', 'student_details': []}<br />{'_id': ObjectId('672b18432f4aee46bf5875d3'), 'course': 'History 201', 'enrollments': 20, 'department': 'History', 'student_details': []}</pre><h3>Kesimpulan</h3><p>Pada artikel ini, kita telah mempelajari operasi CRUD lanjutan di MongoDB, seperti <strong>bulk write</strong> untuk menyisipkan, memperbarui, dan menghapus data dalam satu batch. Selain itu, kita juga belajar bagaimana menggunakan query kompleks untuk menyaring data berdasarkan kondisi tertentu dan melakukan agregasi untuk analisis data, seperti menghitung rata-rata atau jumlah. Dengan memahami teknik-teknik ini, Anda akan lebih efisien dalam mengelola dan menganalisis data di MongoDB.</p><h3>Referensi</h3><p><a href="https://drive.google.com/file/d/14Kwo0gUmS___ao9hUnh-MLF9QNMhHx3F/view?usp=sharing">Hands_On_Pertemuan_11.ipynb</a></p><img alt="" height="1" src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=6403253b25a4" width="1" />
<!--END_SECTION:medium-->